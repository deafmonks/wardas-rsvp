<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shaadi Invitation & RSVP</title>

  <!-- Google Font: Mukta -->
  <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300;500;700&display=swap" rel="stylesheet" /> <!-- [web:57] -->

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- HERO CAROUSEL GRID -->
  <section class="hero" style="padding:16px;">
      <div class="carousel-grid" style="display:flex;gap:12px;justify-content:flex-start;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;">
        <!-- four small carousels, each 250px wide -->
        <!-- removed one mini-carousel to keep three total -->

        <div class="mini-carousel" style="width:250px;">
          <div class="slides">
            <div class="slide active"><img src="bride.JPG" alt="Bride and groom" style="width:100%;height:auto;"/></div>
            <div class="slide"><img src="family.JPG" alt="" style="width:100%;height:auto;"/></div>
          </div>
          <button class="carousel-btn prev">&#10094;</button>
          <button class="carousel-btn next">&#10095;</button>
        </div>

        <div class="mini-carousel" style="width:250px;">
          <div class="slides">
            <div class="slide active"><img src="bride.JPG" alt="Bride and groom" style="width:100%;height:auto;"/></div>
            <div class="slide"><img src="family.JPG" alt="" style="width:100%;height:auto;"/></div>
          </div>
          <button class="carousel-btn prev">&#10094;</button>
          <button class="carousel-btn next">&#10095;</button>
        </div>

        <div class="mini-carousel" style="width:250px;">
          <div class="slides">
            <div class="slide active"><img src="bride.JPG" alt="Bride and groom" style="width:100%;height:auto;"/></div>
            <div class="slide"><img src="family.JPG" alt="" style="width:100%;height:auto;"/></div>
          </div>
          <button class="carousel-btn prev">&#10094;</button>
          <button class="carousel-btn next">&#10095;</button>
        </div>
      </div>
    </section>

  <div class="page">
    <!-- INVITATION CARD -->
    <header class="invite-card">
      <div class="top-border"></div>
      <h2 class="tiny-text">words?</h2>
      <h1 class="names">Warda &amp; Nawal</h1>
      <p class="parents">With the blessings of their families</p>
      <p class="line">joyfully invite you to celebrate their wedding</p>

      <div class="details">
        <p class="label">Date</p>
        <p class="value">Sunday, 7 June 2026</p>
        <p class="label">Time</p>
        <p class="value">5:30 PM onwards</p>
        <p class="label">Venue</p>
        <p class="value">10227 County Road 2426, Terrell, TX 75160</p>
      </div>

      <p class="note">
        Dress code: Traditional desi (lehenga, sherwani, kurta, saree)
      </p>
      <div class="bottom-border"></div>
    </header>

    <!-- COUPLE PHOTOS -->
    <section class="couple-photos" aria-label="Couple photos" style="display:flex;gap:16px;justify-content:center;margin:24px 0;">
      <div style="flex:1;max-width:280px;text-align:center;">
        <img src="bride.JPG" alt="Bride" style="width:100%;height:auto;border-radius:8px;object-fit:cover;" />
      </div>
      <div style="flex:1;max-width:280px;text-align:center;">
        <img src="groom.jpg" alt="Groom" style="width:100%;height:auto;border-radius:8px;object-fit:cover;" />
      </div>
    </section>

    <!-- RSVP SECTION -->
    <section class="rsvp-section" id="rsvp">
      <h2>RSVP</h2>
      <p class="rsvp-text">
        Please let us know if you will be able to join us.
      </p>

      <form name="rsvp-to-google-sheet" class="rsvp-form">
        <label for="firstName">First Name</label>
        <input id="firstName" name="firstName" type="text" required />

        <label for="lastName">Last Name</label>
        <input id="lastName" name="lastName" type="text" required />

        <!-- Hidden concatenated full name for backend compatibility -->
        <input id="name" name="name" type="hidden" />

        <label for="side">Are you from the groom's side or the bride's side?</label>
        <select id="side" name="side" required>
          <option value="">Select...</option>
          <option value="groom">Groom's side</option>
          <option value="bride">Bride's side</option>
        </select>

        <label for="attendance">Will you attend?</label>
        <select id="attendance" name="attendance" required>
          <option value="">Select an option</option>
          <option value="yes">Yes, I will be there</option>
          <option value="no">Sorry, I cannot attend</option>
        </select>

        <div id="attendingFields">
          <label for="guests">Number of Guests (excluding you)</label>
          <input
            id="guests"
            name="guests"
            type="number"
            min="0"
            max="10"
            value="0"
          />

          <div id="guestList" aria-live="polite"></div>

          <label for="meal">Your Meal Preference</label>
          <select id="meal" name="meal">
            <option value="">Select...</option>
            <option value="veg">Veg</option>
            <option value="non-veg">Non‑veg</option>
            <option value="na">N/A</option>
          </select>
        </div>

        <label for="message">Message for the couple</label>
        <textarea id="message" name="message" rows="3"></textarea>

        <button type="submit">Submit RSVP</button>
        <p class="success-message" id="successMessage" hidden>
          Shukriya! Your RSVP has been received.
        </p>
        <p class="error-message" id="errorMessage" hidden>
          Something went wrong. Please try again.
        </p>
      </form>
    </section>
  </div>

  <script>
    // ------------ CAROUSEL (multiple mini carousels) ------------
    document.querySelectorAll('.mini-carousel').forEach((carousel) => {
      const slides = carousel.querySelectorAll('.slide');
      const prevBtn = carousel.querySelector('.carousel-btn.prev');
      const nextBtn = carousel.querySelector('.carousel-btn.next');
      let current = 0;

      function show(i) {
        slides.forEach((s, idx) => s.classList.toggle('active', idx === i));
      }

      function goNext() {
        current = (current + 1) % slides.length;
        show(current);
      }

      function goPrev() {
        current = (current - 1 + slides.length) % slides.length;
        show(current);
      }

      if (nextBtn) nextBtn.addEventListener('click', goNext);
      if (prevBtn) prevBtn.addEventListener('click', goPrev);

      if (slides.length > 1) {
        // auto-advance each mini-carousel
        setInterval(goNext, 4000 + Math.floor(Math.random() * 2000));
      }
    });

    // ------------ RSVP + GOOGLE SHEETS ------------
    // Vercel function URL (deployed)
    const scriptURL = 'https://wardas-rsvp.vercel.app/api/rsvp';
    const form = document.forms['rsvp-to-google-sheet'];
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    const attendanceSelect = document.getElementById('attendance');
    const attendingFields = document.getElementById('attendingFields');
    const guestsInput = document.getElementById('guests');
    const guestList = document.getElementById('guestList');
    const mealSelect = document.getElementById('meal');
    const firstNameInput = document.getElementById('firstName');
    const lastNameInput = document.getElementById('lastName');
    const fullNameHidden = document.getElementById('name');

    function updateAttendingFields() {
      const attending = attendanceSelect.value === 'yes';
      attendingFields.style.display = attending ? 'block' : 'none';

      if (!attending) {
        guestsInput.value = 0;
        renderGuestFields(0);
      }
    }

    function renderGuestFields(count) {
      guestList.innerHTML = '';
      count = Math.max(0, Math.min(10, parseInt(count || 0, 10)));

      for (let i = 1; i <= count; i++) {
        const wrapper = document.createElement('div');
        wrapper.className = 'guest-card';

        wrapper.innerHTML = `
          <h4>Guest ${i}</h4>
          <label for="guest_${i}_first">First Name</label>
          <input id="guest_${i}_first" name="guest_${i}_first" type="text" required />

          <label for="guest_${i}_last">Last Name</label>
          <input id="guest_${i}_last" name="guest_${i}_last" type="text" required />

          <!-- Hidden concatenated full name for backend compatibility -->
          <input id="guest_${i}_name" name="guest_${i}_name" type="hidden" />

          <div class="guest-meal-display"><span id="guest_${i}_meal_display"></span></div>
          <label for="guest_${i}_meal">Meal Preference</label>
          <select id="guest_${i}_meal" name="guest_${i}_meal">
            <option value="">Select...</option>
            <option value="veg">Veg</option>
            <option value="non-veg">Non‑veg</option>
            <option value="na">N/A</option>
          </select>
        `;

        guestList.appendChild(wrapper);

        const mealSel = wrapper.querySelector(`#guest_${i}_meal`);
        const mealDisp = wrapper.querySelector(`#guest_${i}_meal_display`);
        mealSel.addEventListener('change', () => {
          mealDisp.textContent = mealSel.value || '';
        });
      }
    }

    function enforceGuestNamesRequirement() {
      const guests = parseInt(guestsInput.value || '0', 10);
      for (let i = 1; i <= 10; i++) {
        const firstInput = document.getElementById(`guest_${i}_first`);
        const lastInput = document.getElementById(`guest_${i}_last`);
        if (firstInput) {
          if (i <= guests) firstInput.setAttribute('required', 'required');
          else {
            firstInput.removeAttribute('required');
            firstInput.value = '';
          }
        }
        if (lastInput) {
          if (i <= guests) lastInput.setAttribute('required', 'required');
          else {
            lastInput.removeAttribute('required');
            lastInput.value = '';
          }
        }
        // clear hidden concatenated name for non-existing guests
        const hidden = document.getElementById(`guest_${i}_name`);
        if (hidden && i > guests) hidden.value = '';
      }
    }

    attendanceSelect.addEventListener('change', updateAttendingFields);
    guestsInput.addEventListener('input', () => {
      renderGuestFields(guestsInput.value);
      enforceGuestNamesRequirement();
    });

    updateAttendingFields();
    renderGuestFields(guestsInput.value);
    enforceGuestNamesRequirement();

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      successMessage.hidden = true;
      errorMessage.hidden = true;
      errorMessage.textContent = 'Something went wrong. Please try again.';

      // Populate hidden full name for server-side compatibility
      if (firstNameInput && lastNameInput && fullNameHidden) {
        const f = (firstNameInput.value || '').trim();
        const l = (lastNameInput.value || '').trim();
        fullNameHidden.value = (f || l) ? `${f} ${l}`.trim() : '';
      }

      const guests = parseInt(guestsInput.value || '0', 10);
      if (attendanceSelect.value === 'yes') {
        for (let i = 1; i <= guests; i++) {
          const first = document.getElementById(`guest_${i}_first`);
          const last = document.getElementById(`guest_${i}_last`);
          const hidden = document.getElementById(`guest_${i}_name`);
          const firstVal = first ? (first.value || '').trim() : '';
          const lastVal = last ? (last.value || '').trim() : '';

          if (!firstVal || !lastVal) {
            errorMessage.textContent = `Please enter first and last name for Guest ${i}.`;
            errorMessage.hidden = false;
            return;
          }

          // populate hidden concatenated name for backend
          if (hidden) hidden.value = `${firstVal} ${lastVal}`.trim();
        }
      }

      // Send URL-encoded payload and handle errors with detailed logging
      const payload = new URLSearchParams(new FormData(form));
      fetch(scriptURL, {
        method: 'POST',
        body: payload,
      })
        .then(async (res) => {
          if (!res.ok) {
            const text = await res.text().catch(() => '');
            throw new Error(`HTTP ${res.status} ${res.statusText} - ${text}`);
          }
          try {
            return await res.json();
          } catch (e) {
            return { status: 'ok' };
          }
        })
        .then((data) => {
          successMessage.hidden = false;
          form.reset();
          updateAttendingFields();
          renderGuestFields(0);
          enforceGuestNamesRequirement();
          // ensure hidden name cleared after reset
          if (fullNameHidden) fullNameHidden.value = '';
          // clear guest hidden names as well
          for (let i = 1; i <= 10; i++) {
            const h = document.getElementById(`guest_${i}_name`);
            if (h) h.value = '';
          }
        })
        .catch((err) => {
          console.error('Submit error:', err);
          errorMessage.textContent = err.message || 'Something went wrong. Please try again.';
          errorMessage.hidden = false;
        });
    });
  </script>
</body>
</html>
